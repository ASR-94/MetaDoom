version "2.4"

// thanks gutawer!
Class SpawnEnvActorHandler : EventHandler
{
	override void WorldLoaded(WorldEvent e)
	{
		for (int i = 0; i < level.Sectors.Size(); i++)
		{
			let c = level.Sectors[i].centerspot;
			Actor.Spawn("MetaEnvActor", (c.x, c.y, level.Sectors[i].floorplane.ZAtPoint(c)));
		}
	}
}

class MetaEnvActor : Actor
{
	Default
	{
		-SOLID
		+DONTSPLASH
		+NOTELEPORT
	}
	
	States
	{
	Spawn:
		TNT1 A 0;
		TNT1 A 0
		{
			A_SpawnItem("MetaEnvActorSeed");
			A_SpawnItemEx("MetaEnvActorSeed",0,0,32,random(8,16),random(8,16),random(8,16),random(0,360));
			A_SpawnItemEx("MetaEnvActorSeed",0,0,32,random(8,16),random(8,16),random(8,16),random(0,360));
			A_SpawnItemEx("MetaEnvActorSeed",0,0,32,random(8,32),random(8,32),random(8,32),random(0,360));
			A_SpawnItemEx("MetaEnvActorSeed",0,0,32,random(8,32),random(8,32),random(8,32),random(0,360));
		}
		stop;
	}
}

class MetaEnvActorSeed : Actor
{
	Default
	{
		-SOLID
		+CORPSE
		+DONTSPLASH
		+NOTELEPORT
		+NOCLIP
		radius 1;
		height 1;
	}
	
	States
	{
	Spawn:
		TNT1 A 0;
		TNT1 A 1;
		loop;
	Crash:
		TNT1 A 0
		{
			if (floorpic == TexMan.CheckForTexture("NUKAGE1", TexMan.Type_Any))
			{
				A_SpawnItem("MetaSectorNukageCore");
			}
			
			if (floorpic == TexMan.CheckForTexture("NUKAGE2", TexMan.Type_Any))
			{
				A_SpawnItem("MetaSectorNukageCore");
			}
			
			if (floorpic == TexMan.CheckForTexture("NUKAGE3", TexMan.Type_Any))
			{
				A_SpawnItem("MetaSectorNukageCore");
			}
			
			if (floorpic == TexMan.CheckForTexture("NUKAGE4", TexMan.Type_Any))
			{
				A_SpawnItem("MetaSectorNukageCore");
			}
		}
		Stop;
	}
}