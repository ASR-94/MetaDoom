actor SoulCubeUsed : Boolean {}

ACTOR MetaSoulcube : MetaDoomWeapon
{
	Weapon.SelectionOrder 2900
	Obituary "$OB_METASOULCUBE"
	Weapon.AmmoUse 10
	Weapon.AmmoType "SoulAmmo"
	Inventory.Pickupmessage "$GOTSOULCUBE"
	Inventory.PickupSound "weapons/soulcube/get"
	Tag "$TAGSOULCUBE"
	+INVENTORY.ALWAYSPICKUP
	+INVENTORY.UNTOSSABLE
	+FLOATBOB
	States
	{
	Ready:
		SOLW A 1 A_WeaponReady
		"####" A 0 A_JumpIfInventory("MeleePunch", 1, "MeleePunch")
		Loop
	Deselect:
		SOLW A 0
		SOLW A 0 A_JumpIf(health <= 0, "DeadDude")
		SOLW A 0 A_JumpIfInventory("SoulCubeUsed", 1, "FinishDeselect")
		SOLW A 1 Offset(0,33) A_PlaySound("weapons/swap")
		SOLW A 1 Offset(0,35)
		SOLW A 1 Offset(0,39)
		SOLW A 1 Offset(0,44)
		SOLW A 1 Offset(0,49)
		SOLW A 1 Offset(0,55)
		SOLW A 1 Offset(0,60)
		SOLW A 1 Offset(0,70)
		SOLW A 1 Offset(0,80)
		SOLW A 1 Offset(0,90)
	FinishDeselect:
		SOLW A 0 A_TakeInventory("SoulCubeUsed", 9999)
		SOLW A 0 A_Lower
		Loop
	Select:
		SOLW A 1 Offset(0,90) A_PlaySound("weapons/soulcube/use")
		SOLW A 1 Offset(0,80)
		SOLW A 1 Offset(0,70)
		SOLW A 1 Offset(0,60)
		SOLW A 1 Offset(0,55)
		SOLW A 1 Offset(0,49)
		SOLW A 1 Offset(0,44)
		SOLW A 1 Offset(0,39)
		SOLW A 1 Offset(0,35)
		SOLW A 1 Offset(0,33)
		SOLW A 1 Offset(0,32)
		SOLW A 1 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
		goto Ready
	Fire:
		SOLW A 4
		SOLW B 3 bright A_PlaySound("weapons/soulcube/fire", CHAN_WEAPON)
		SOLW CDE 3
		SOLW E 2 Offset(0,35)
		SOLW E 2 Offset(0,45)
		SOLW E 2 Offset(0,65)
		SOLW E 2 Offset(0,85)
		TNT1 A 2 Offset(0,85) A_FireCustomMissile("MetaSoulCubeProj")
		TNT1 A 0 Offset(0,32)
		TNT1 A 0 A_GiveInventory("SoulCubeUsed", 1)
		TNT1 A 0 A_SelectWeapon ("WEAPONTHATDOESNTEXIST!",  SWF_SELECTPRIORITY)
		Goto Ready
	Flash:
		TNT1 A 4 Bright A_Light1
		Goto LightDone
		TNT1 A 4 Bright A_Light1
		Goto LightDone
 	Spawn:
		SOLP XYZY 10 bright
		loop
	}
}

ACTOR MetaSoulCubeProj
{
	Radius 13
	Height 8
	Speed 35
	Damage (2000)
	Projectile
	+RANDOMIZE
	+FLATSPRITE
	+ROLLSPRITE
	+ROLLCENTER
	+SEEKERMISSILE
	+SCREENSEEKER
	RenderStyle Add
	Alpha 1
	Obituary "$OB_METASOULCUBE"
	scale 0.5
	Decal PlasmaScorch
	States
	{
	Spawn:
		SOLP A 0 A_PlaySound ("weapons/soulcube/loop", CHAN_BODY, 1.0, 1)
		SOLP A 0 A_SeekerMissile(0, 90)
		SOLP A 1 Bright A_SetRoll((roll + 15))
		Loop
	Death:
		TNT1 A 0 A_PlaySound("weapons/soulcube/end")
		TNT1 A 0
		Stop
	}
}